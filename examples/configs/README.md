# External Configuration Examples

This directory contains example external SAM configuration files generated by the `multi-pipeline.yml` example.

## What are External Configs?

External configuration files are standalone SAM config files that:

- **ğŸ”„ Are generated dynamically** by samstacks based on your pipeline definition
- **ğŸ“¦ Work independently** with SAM CLI without requiring samstacks
- **ğŸ§¹ Keep stack directories clean** by avoiding generated files in source code
- **ğŸŒ Support multi-environment** deployments from a single pipeline
- **ğŸ”— Are GitOps-ready** and can be committed to version control

## How It Works

When you run the multi-environment pipeline:

```bash
# Deploy to development environment
samstacks deploy examples/multi-pipeline.yml --input environment=dev

# Deploy to staging environment  
samstacks deploy examples/multi-pipeline.yml --input environment=staging

# Deploy to production environment
samstacks deploy examples/multi-pipeline.yml --input environment=prod
```

Samstacks will:

1. **Process template expressions** in the `config:` field:
   ```yaml
   config: configs/${{ inputs.environment }}/processor.yaml
   # Becomes: configs/dev/processor.yaml (for dev environment)
   ```

2. **Generate external config files** at the resolved paths:
   ```
   examples/
   â”œâ”€â”€ configs/
   â”‚   â”œâ”€â”€ dev/
   â”‚   â”‚   â”œâ”€â”€ processor.yaml
   â”‚   â”‚   â””â”€â”€ storage.yaml
   â”‚   â”œâ”€â”€ staging/
   â”‚   â”‚   â”œâ”€â”€ processor.yaml
   â”‚   â”‚   â””â”€â”€ storage.yaml
   â”‚   â””â”€â”€ prod/
   â”‚       â”œâ”€â”€ processor.yaml
   â”‚       â””â”€â”€ storage.yaml
   ```

3. **Use `--config-file`** to deploy with SAM CLI:
   ```bash
   sam build --config-file configs/dev/processor.yaml
   sam deploy --config-file configs/dev/processor.yaml
   ```

## Example Config Files

This directory contains sample generated config files that show:

- **Environment-specific parameters** resolved from template expressions
- **Template references** pointing to the correct stack directories
- **Complete SAM configuration** ready for independent use

## Benefits

### ğŸ”„ Single Pipeline, Multiple Environments
No need to duplicate pipeline files - one pipeline supports all environments.

### ğŸ“¦ Standalone Deployment  
Generated configs work directly with SAM CLI without any samstacks dependencies.

### ğŸ§¹ Clean Source Code
Your stack directories stay clean without generated configuration files.

### ğŸ”— GitOps Workflows
External configs can be committed and used in CI/CD pipelines.

### âš¡ Direct SAM CLI Usage
Skip samstacks for quick development iterations:

```bash
# Quick development cycle
sam build --config-file configs/dev/processor.yaml
sam local start-api --config-file configs/dev/processor.yaml
```

## Try It Out

1. **Generate configs** by running the multi-pipeline:
   ```bash
   cd examples
   samstacks deploy multi-pipeline.yml --input environment=dev
   ```

2. **Use generated configs** directly with SAM:
   ```bash
   sam deploy --config-file configs/dev/processor.yaml
   ```

3. **Deploy to different environments**:
   ```bash
   # Staging
   samstacks deploy multi-pipeline.yml --input environment=staging
   
   # Production with different settings
   samstacks deploy multi-pipeline.yml \
     --input environment=prod \
     --input log_level=ERROR \
     --input enable_xray=true
   ``` 